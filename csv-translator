<!doctype html><meta charset="utf-8">
<textarea id=t style="width:100%;height:260px" placeholder="Buraya yapıştır..."></textarea>
<button id=b>CSV indir</button>
<script>
D="Sescibaba"; // Firma kolonu yoksa buraya yaz (istersen "" yap)
E=s=>/["\n,]/.test(s)?'"'+s.replace(/"/g,'""')+'"':s;
N=s=>!s||/^(Tümü|Sesçibaba Logo|Şirketler|Siparişler|Onay Bekleyen|Sipariş Listesi|İade Listesi|Sesçibaba Stokları|Stok Listesi|Ara|Previous|Next|E-Commerce Management.*|Showing\b.*|Marka\s+Model\s+Stok\s+Kodu.*|\d+)$/.test(s);
P=l=>{
  l=l.replace(/\u00A0/g," ").trim(); if(N(l))return;
  if(l.includes("\t")){
    a=l.split("\t").map(x=>x.trim()).filter(Boolean); if(a.length<6)return;
    if(a.length==6){m=a[0];mo=a[1];k=a[2];ac=a[3];s=a[4];w=a[5];f=D;}
    else{m=a[0];f=a.at(-1);w=a.at(-2);s=a.at(-3);mid=a.slice(1,-3);if(mid.length<3)return;mo=mid.slice(0,-2).join(" ");k=mid.at(-2);ac=mid.at(-1);}
    if(!/^\d+$/.test(s))return; return [m,mo,k,ac,s,w,f];
  }
};
b.onclick=()=>{
  R=t.value.split(/\r\n|\r|\n/).map(P).filter(Boolean);
  C="Marka,Model,Stok Kodu,Açıklama,Stok,Ambar,Firma\n"+R.map(r=>r.map(v=>E((v??"")+"")).join(",")).join("\n");
  U=URL.createObjectURL(new Blob(["\ufeff"+C],{type:"text/csv;charset=utf-8"}));
  A=document.createElement("a");A.href=U;A.download="stoklar.csv";A.click();setTimeout(()=>URL.revokeObjectURL(U),500);
};
</script>
