<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compel ⇄ Products Eşleştirici</title>
  <style>
    :root{color-scheme:dark}
    html,body{height:100%}
    body{
      margin:0;height:100vh;overflow:hidden;display:flex;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:#0b0d12;color:#eaeef7
    }

    /* Layout */
    main{
      flex:1;min-height:0;display:flex;flex-direction:column;overflow:hidden
    }
    header.topbar{
      padding:8px;border-bottom:1px solid #1f2430;
      background:#0b0d12;flex:0 0 auto
    }
    .controls{
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center
    }

    /* Buttons + inputs theme */
    button,.file{
      background:#111827;color:#eaeef7;border:1px solid #2a3140;border-radius:10px;
      font-weight:700;font-size:12px
    }
    button{
      padding:7px 10px;cursor:pointer;line-height:1
    }
    button:hover{background:#1f2a44;border-color:#6b7da6}
    button:disabled{opacity:.55;cursor:not-allowed}
    button:disabled:hover{background:#111827;border-color:#2a3140}

    /* Custom file picker (tek satır + kısaltma) */
    .file{
      display:flex;align-items:center;gap:8px;padding:6px 10px;height:34px;
      user-select:none;cursor:pointer;max-width:520px
    }
    .file input{display:none}
    .fbtn{white-space:nowrap}
    .fname{
      font-weight:600;opacity:.9;font-size:12px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:240px
    }

    .spacer{flex:1 1 auto;min-width:6px}

    /* Chips / status bar */
    .ibox{
      margin-top:8px;display:flex;flex-wrap:wrap;gap:6px;align-items:center;justify-content:center;
      padding:6px 10px;border:1px solid #1f2430;border-radius:10px;background:#0f1320
    }
    .chip{
      padding:2px 8px;border:1px solid #2a3140;border-radius:999px;background:#0b0d12;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%;
      font-weight:800;font-size:12px;line-height:1.25
    }
    .chip.ok{color:#86efac}
    .chip.bad{color:#fca5a5}
    .chip.unk{color:#fcd34d}
    .chip.muted{opacity:.85;font-weight:700}

    /* Panels */
    section.panel{
      padding:8px;min-height:0;display:flex;flex-direction:column;gap:6px;overflow:hidden
    }
    section.panel.results{flex:2 1 0}
    section.panel.unmatched{flex:1 1 0}

    .panelHead{
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between
    }
    .headLeft,.headRight{display:flex;gap:6px;flex-wrap:wrap;align-items:center}

    /* Table */
    .tableWrap{
      flex:1;min-height:0;overflow:auto;
      border:1px solid #1f2430;border-radius:12px;background:#0f1320
    }
    table{
      width:100%;border-collapse:collapse;table-layout:fixed
    }
    th,td{
      border-bottom:1px solid #1f2430;
      padding:6px 8px;
      text-align:center;
      vertical-align:middle;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size:12px;
      line-height:1.15
    }
    th{
      position:sticky;top:0;z-index:2;
      background:#0b0d12;font-weight:900
    }
    tbody tr:hover{background:#111827}

    a{
      color:#93c5fd;text-decoration:none;
      display:block;max-width:100%;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis
    }
    a:hover{text-decoration:underline}

    /* Unmatched inputs */
    input[type=text]{
      width:100%;min-width:78px;box-sizing:border-box;
      background:#111827;color:#eaeef7;border:1px solid #2a3140;border-radius:10px;
      padding:6px 8px;font-weight:700;font-size:12px;line-height:1
    }
    input[type=text]:focus{outline:none;border-color:#6b7da6}

    /* Small screens */
    @media (max-width:900px){
      .fname{max-width:160px}
      button{padding:7px 9px}
      section.panel.results{flex:1.3 1 0}
      section.panel.unmatched{flex:1 1 0}
    }
  </style>
</head>
<body>

<main>
  <header class="topbar">
    <div class="controls">
      <label class="file" title="1) compel-sonuc.csv">
        <span class="fbtn">Compel CSV</span>
        <span class="fname" id="n1">Seçilmedi</span>
        <input id="f1" type="file" accept=".csv,text/csv">
      </label>

      <label class="file" title="2) products.csv">
        <span class="fbtn">Products CSV</span>
        <span class="fname" id="n2">Seçilmedi</span>
        <input id="f2" type="file" accept=".csv,text/csv">
      </label>

      <label class="file" title="3) mapping.json (opsiyonel)">
        <span class="fbtn">Mapping JSON</span>
        <span class="fname" id="n3">Opsiyonel</span>
        <input id="f3" type="file" accept=".json,application/json">
      </label>

      <button id="go">Generate</button>
      <button id="reset" title="Her şeyi sıfırla">Temizle</button>

      <div class="spacer"></div>

      <button id="dl1" disabled>Sonuç CSV</button>
      <button id="dl2" disabled>Eşleşmeyen CSV</button>
      <button id="dl3" disabled>JSON</button>
    </div>

    <div class="ibox" id="st">
      <span class="chip ok">Hazır</span>
      <span class="chip muted">Alias: Allen &amp; Heath → Allen Heath</span>
      <span class="chip muted">products stok “-” = yok</span>
    </div>
  </header>

  <section class="panel results">
    <div class="panelHead">
      <div class="headLeft">
        <span class="chip">Sonuçlar</span>
        <span class="chip muted" id="sum">Toplam 0 • ✓0 • ✕0</span>
      </div>
      <div class="headRight">
        <span class="chip muted">Hücreler tek satır • taşanlar “…”</span>
      </div>
    </div>
    <div class="tableWrap">
      <table id="t1"></table>
    </div>
  </section>

  <section class="panel unmatched">
    <div class="panelHead">
      <div class="headLeft">
        <span class="chip">Eşleşmeyenler</span>
        <span class="chip muted">Manuel: ws / sup gir → Eşleştir</span>
      </div>
    </div>
    <div class="tableWrap">
      <table id="t2"></table>
    </div>
  </section>
</main>

<datalist id="wsCodes"></datalist>
<datalist id="supCodes"></datalist>

<script type="module" src="./js/app.js"></script>
</body>
</html>
